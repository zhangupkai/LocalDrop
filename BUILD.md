# LocalDrop 构建说明

## 概述
本项目已配置了完整的构建系统，可以将 Node.js 应用打包成跨平台的可执行文件。

## 构建文件说明

### build.js
主要的构建脚本，包含以下功能：
- 🧹 清理构建目录
- 📁 复制项目文件
- ⚙️ 创建 pkg 配置文件
- 📦 安装生产依赖
- 🔨 使用 pkg 打包可执行文件
- 📝 创建启动脚本
- 📄 生成说明文档

### 支持的平台
- Windows (x64)

## 使用方法

### 1. 安装依赖
```bash
npm install
```

### 2. 执行构建
```bash
# 方法1: 使用 npm 脚本
npm run build

# 方法2: 直接运行构建脚本
node build.js
```

### 3. 构建输出
构建完成后，所有文件将输出到 `dist` 目录：
```
dist/
├── LocalDrop.exe          # Windows 可执行文件 (含启动提示和前端资源)
└── README.txt             # 使用说明
```

**注意**：
- 前端资源已打包到 exe 文件中
- 文件上传目录会在 exe 文件所在目录中自动创建（`[exe目录]\LocalDrop\uploads`）

## 构建特性

### 自动化流程
- 自动清理旧的构建文件
- 智能复制必要文件
- 临时安装生产依赖（用于 pkg 打包）
- 生成 Windows 可执行文件（含启动提示界面和前端资源）
- 自动清理所有临时文件（node_modules、package.json、server.js）
- 启动提示和前端资源已集成到可执行文件中

### 文件处理
- 前端资源打包到 exe 文件中
- 文件上传目录在 exe 文件所在目录中动态创建
- 保留原始功能完整性

### 启动方式
- **单文件启动**: 直接双击 `LocalDrop.exe`
- **启动提示**: 已集成到 exe 文件中
- **前端资源**: 已打包到 exe 文件中

## 技术细节

### 使用的工具
- **pkg**: 将 Node.js 应用打包成可执行文件
- **Node.js**: 运行时环境
- **Express**: Web 框架

### 构建配置
- 目标 Node.js 版本: 18.x
- 支持平台: win-x64
- 包含所有运行时依赖
- 优化文件大小

### 文件清理说明
- **临时安装**: 构建过程中会在 `dist` 目录临时安装 `node_modules`
- **自动清理**: pkg 打包完成后会自动删除所有临时文件
- **清理内容**: `node_modules/`、`package.json`、`server.js`
- **原因**: 这些文件已打包到可执行文件中，运行时不需要
- **结果**: 最终的 `dist` 目录只包含运行时必需文件，更小更干净

## 故障排除

### 常见问题

1. **exe 文件双击后立即关闭**
   - 程序已添加错误处理，会显示具体错误信息
   - 常见原因：端口被占用、权限不足、防火墙阻止
   - 程序会等待用户按键，确保能看到错误信息

2. **端口被占用**
   - 程序会显示 "端口 9999 已被占用" 错误
   - 关闭占用该端口的程序，或修改 server.js 中的 PORT 变量
   - 重新构建

3. **权限不足**
   - 程序会显示 "权限不足" 错误
   - 以管理员身份运行程序

4. **防火墙问题**
   - 确保 9999 端口可访问
   - 添加防火墙例外规则

5. **pkg 未安装**
   ```bash
   npm install -g pkg
   ```

### 调试模式
如需调试构建过程，可以修改 `build.js` 中的日志级别或添加更多输出信息。

## 分发说明

构建完成后，可以将 `dist` 目录打包分发给用户：
- **必需文件**：`LocalDrop.exe`（包含所有功能）
- **可选文件**：`README.txt`（使用说明）
- **单文件分发**：用户只需一个 exe 文件即可获得完整体验
- **自动创建**：文件上传目录会在 exe 文件所在目录中自动创建

## 版本信息
- 构建脚本版本: 1.0.0
- 支持 Node.js: 18.x+
- 支持平台: Windows x64
